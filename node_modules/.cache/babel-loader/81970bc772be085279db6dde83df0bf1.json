{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\AEPL\\\\Desktop\\\\Git Clones\\\\Dummy_project\\\\Backend\\\\dummy1\\\\src\\\\components\\\\conversations\\\\Conversation.jsx\",\n    _s = $RefreshSig$();\n\nimport axios from 'axios';\nimport { useEffect, useState, useRef } from 'react';\nimport './conversation.css';\nimport { msgUrl, alertMsgUrl, pinChatUrl, markChatUrl, stickComment, fetchStickComment } from '../../serviceUrls/Message-Services';\nimport NotificationsIcon from '@material-ui/icons/Notifications';\nimport { io } from 'socket.io-client';\nimport moment from 'moment';\nimport PushPinIcon from '@mui/icons-material/PushPin';\nimport Button from '@mui/material/Button';\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\nimport Badge from '@mui/material/Badge';\nimport Avatar from '@mui/material/Avatar';\nimport StickComments from \"../dialogs/StickComments\";\nimport InfoIcon from \"@mui/icons-material/Info\";\nimport { styled } from \"@mui/material/styles\";\nimport Tooltip, { tooltipClasses } from \"@mui/material/Tooltip\";\nimport Typography from \"@mui/material/Typography\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst HtmlTooltip = styled(_ref => {\n  let {\n    className,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/_jsxDEV(Tooltip, { ...props,\n    classes: {\n      popper: className\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 3\n  }, this);\n})(_ref2 => {\n  let {\n    theme\n  } = _ref2;\n  return {\n    [`& .${tooltipClasses.tooltip}`]: {\n      backgroundColor: \"rgba(80, 80, 80, 0.92)\",\n      color: \"#ffff\",\n      fontWeight: \"500\",\n      maxWidth: 350,\n      fontSize: theme.typography.pxToRem(12),\n      border: \"1px solid rgba(80, 80, 80, 0.92)\",\n      overflowX: \"hidden\",\n      overflowY: \"scroll\",\n      maxHeight: \"300px\"\n    }\n  };\n}); // import useSound from 'use-sound';\n// import notification from '../../assets/notification.mp3';\n\nexport default function Conversation(_ref3) {\n  _s();\n\n  var _conversation$name;\n\n  let {\n    apiUrl,\n    conversation,\n    currentUser,\n    currentChat,\n    finalMessage,\n    arrivalMessage,\n    alertMsg,\n    alert,\n    setAlert,\n    setPinned,\n    setMarkChat,\n    setAlertUpdate\n  } = _ref3;\n  const [msg, setMsg] = useState([]);\n  const [alertText, setAlertText] = useState([]);\n  const [alertMessage, setAlertMessage] = useState([]); // const [hide, setHide] = useState(false);\n\n  const [msgCount, setMsgCount] = useState();\n  const socket = useRef();\n  const alertIcon = useRef();\n  const PF = process.env.REACT_APP_PUBLIC_FOLDER;\n  const headerKey = {\n    Accept: 'application/json',\n    Authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMTYyMWZkZi0wYjJjLTQxYzAtOWZmMS1iZDk5NWZmYTQ2ZTUiLCJ1bmlxdWVfbmFtZSI6Im9mZmljZUB0dXRvcnBvaW50LmluIiwibmFtZWlkIjoib2ZmaWNlQHR1dG9ycG9pbnQuaW4iLCJlbWFpbCI6Im9mZmljZUB0dXRvcnBvaW50LmluIiwiYXV0aF90aW1lIjoiMDgvMDQvMjAyMSAwODoxMTowMSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IkFETUlOSVNUUkFUT1IiLCJleHAiOjI1MzQwMjMwMDgwMCwiaXNzIjoiQ2xhcmVfQUkiLCJhdWQiOiJDbGFyZV9BSSJ9.lSSh1EL29ksj23Y_rTSrLhYVwhOFyddK1c6bKU-_HB4'\n  };\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [stickComments, setStickComments] = useState();\n  const [noteDetails, setNoteDetails] = useState();\n  const open = Boolean(anchorEl);\n\n  const handleClick = event => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  console.log(msg); // useEffect(() => {\n  //   const friendId = conversation.id;\n  //   const getUser = async () => {\n  //     try {\n  //       const res = await axios(getCustomersUrl + `/${friendId}`, {headers: {...headerKey}});\n  //       setUser(res.data);\n  //     } catch (err) {\n  //       console.log(err);\n  //     }\n  //   };\n  //   getUser();\n  // }, [conversation]);\n  // useEffect(() => {\n  //   socket.current = io('ws://localhost:8900');\n  //   socket.current.on('getAlert', (msg) => {\n  //     // storeFiles(msg); //store incoming files data to excel\n  //     setAlertMsg([msg]);\n  //   });\n  // }, []);\n  // const [play] = useSound(notification);\n  // useEffect(() => {\n  //   const getMessages = async () => {\n  //     try {\n  //       const res = await axios.get(\n  //         msgUrl + `/${conversation?.wa_id}?page=0&limit=20`,\n  //         {\n  //           headers: { ...headerKey },\n  //         }\n  //       );\n  //       console.log(res.data);\n  //       // setMessages(() =>\n  //       //   res?.data?.messages?.items\n  //       //     .filter((f) => f.eventType === 'message')\n  //       //     .reverse()\n  //       // );\n  //       setMsg([...res?.data]);\n  //     } catch (err) {\n  //       console.log(err);\n  //     }\n  //   };\n  //   getMessages();\n  // }, [newNotification, alertMsg]);\n  // console.log(arrivalMessage.length);\n  // // useEffect(() => {\n  // //   play();\n  // // }, [arrivalMessage?.length])\n  // useEffect(() => {\n  //   const getAlert = async () => {\n  //     try {\n  //       const res = await axios.get(alertMsgUrl + `/${conversation?.wa_id}`, {\n  //         headers: {},\n  //       });\n  //       console.log(res.data);\n  //       // setMessages(() =>\n  //       //   res?.data?.messages?.items\n  //       //     .filter((f) => f.eventType === 'message')\n  //       //     .reverse()\n  //       // );\n  //       setMsg([...res?.data]);\n  //       setMsgCount(() => res?.data?.filter((i) => i.status === 'newMsg' && i.wa_id == conversation?.wa_id).length);\n  //       setHide(false);\n  //     } catch (err) {\n  //       console.log(err);\n  //     }\n  //   };\n  //   getAlert();\n  // }, [alertMsg, newNotification]);\n  // console.log(alertMessage);\n  // useEffect(() => {\n  //   setMsgCount(\n  //     () =>\n  //       alertMessage?.filter(\n  //         (i) => i.status === 'newMsg' && i.wa_id == conversation?.wa_id\n  //       ).length\n  //   );\n  // }, [alertMessage, alertMsg, newNotification]);\n\n  const updateAlert = async wa_id => {\n    if (conversation.newMsgCount > 0) {\n      try {\n        const payload = {\n          newMsgCount: 0,\n          timestamp: Math.floor(new Date().getTime() / 1000.0)\n        };\n        const response = await axios.put(`${apiUrl || localStorage.getItem('api')}/api/conversations/${wa_id}`, payload, {\n          headers: {}\n        });\n        setAlertUpdate(Math.floor(new Date().getTime() / 1000.0));\n      } catch (err) {\n        console.log(err);\n      }\n    }\n  };\n\n  console.log(alertMessage);\n\n  const diff_hours = dt1 => {\n    var diff = new Date().getTime() / 1000.0 - dt1;\n    diff /= 60 * 60;\n    return Math.abs(Math.round(diff));\n  }; // const filteredArrivalMessage = alertMsg?.filter(\n  //   (i) => i.wAid === conversation.wAid\n  // );\n  // const newNoti = (id) => {\n  //   let filtered = alertText.filter((i) => i.waId === id);\n  //   console.log(filtered);\n  //   return { arr: filtered, len: filtered.length };\n  // };\n  // useEffect(() => {\n  //   setAlertText([...alertText, ...alertMsg]);\n  //   setAlert(alert + 1);\n  //   // return () => {\n  //   //   setAlertText([])\n  //   // }\n  // }, [alertMsg]);\n  // let filteredAlert = alertText?.filter((i) => i.waId === conversation?.wAid);\n  // console.log(alertMsg);\n  // console.log(alertText);\n  // console.log(alert);\n\n\n  const handlePinChat = async (waId, pin) => {\n    var _res$data;\n\n    const payload = {\n      pinContact: !pin\n    };\n    const res = await axios.put(pinChatUrl + `/${waId}`, payload, {\n      headers: ''\n    });\n    setPinned(res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.updatedAt);\n  };\n\n  const handleMarkChat = async (waId, markChat) => {\n    var _res$data2;\n\n    const payload = {\n      markAsUnread: !markChat\n    };\n    const res = await axios.put(markChatUrl + `/${waId}`, payload, {\n      headers: ''\n    });\n    setMarkChat(res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.updatedAt);\n  };\n\n  const handleStickComments = async (whatsId, stickComments) => {\n    const payload = {\n      comments: stickComments\n    };\n    const res = await axios.put(stickComment + `/${whatsId}`, payload, {\n      headers: ''\n    });\n    fetchStickComments(whatsId); // setStickComments(res?.data?.comments);\n\n    handleClose();\n  };\n\n  const fetchStickComments = async waId => {\n    const res = await axios.get(fetchStickComment + `/${waId}`);\n\n    if (res.data) {\n      setStickComments(res.data);\n    }\n  };\n\n  const getNoteDetails = async waId => {\n    try {\n      const response = await axios.get(`${localStorage.getItem(\"api\")}/api/messages/getNotes/${waId}`);\n      setNoteDetails(response.data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const shortText = text => {\n    if (text.length > 17) {\n      return `${text.slice(0, 17)}..`;\n    } else if (text.length <= 17) {\n      return text;\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: (currentChat === null || currentChat === void 0 ? void 0 : currentChat.wa_id) == (conversation === null || conversation === void 0 ? void 0 : conversation.wa_id) ? 'conversation highlighted' : 'conversation',\n    onClick: () => {\n      updateAlert(conversation === null || conversation === void 0 ? void 0 : conversation.wa_id);\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"userTab\",\n      children: [/*#__PURE__*/_jsxDEV(Avatar, {\n        className: \"conversationImg\",\n        children: conversation === null || conversation === void 0 ? void 0 : (_conversation$name = conversation.name) === null || _conversation$name === void 0 ? void 0 : _conversation$name.slice(0, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          paddingBottom: '5px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"conversationName\",\n          children: [`${conversation === null || conversation === void 0 ? void 0 : conversation.name}${conversation === null || conversation === void 0 ? void 0 : conversation.wa_id.slice(0, 3)}`, /*#__PURE__*/_jsxDEV(HtmlTooltip, {\n            placement: \"right\",\n            title: /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                color: \"inherit\",\n                style: {\n                  fontSize: \"13.5px\",\n                  fontWeight: \"600\",\n                  marginBottom: \"5px\"\n                },\n                children: noteDetails && noteDetails.length > 0 ? 'Notes: ' : 'No Notes'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 309,\n                columnNumber: 21\n              }, this), noteDetails && noteDetails.length > 0 && /*#__PURE__*/_jsxDEV(Typography, {\n                color: \"inherit\",\n                style: {\n                  fontSize: \"13.5px\",\n                  fontWeight: \"600\",\n                  marginBottom: \"5px\",\n                  maxHeight: \"500px\",\n                  overflowY: \"scroll\"\n                },\n                children: noteDetails.map(i => {\n                  var _i$clientNotes, _i$clientNotes2, _i$clientNotes3;\n\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      fontSize: \"12px\",\n                      fontWeight: \"normal\",\n                      padding: '8px 5px',\n                      borderBottom: '1px solid #ffff'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        display: 'flex',\n                        flex: '60%',\n                        fontSize: '13px',\n                        fontWeight: '600',\n                        color: (i === null || i === void 0 ? void 0 : (_i$clientNotes = i.clientNotes) === null || _i$clientNotes === void 0 ? void 0 : _i$clientNotes.priority) === 'high' ? 'red' : (i === null || i === void 0 ? void 0 : (_i$clientNotes2 = i.clientNotes) === null || _i$clientNotes2 === void 0 ? void 0 : _i$clientNotes2.priority) === 'medium' ? 'royalblue' : '#565555'\n                      },\n                      children: i === null || i === void 0 ? void 0 : (_i$clientNotes3 = i.clientNotes) === null || _i$clientNotes3 === void 0 ? void 0 : _i$clientNotes3.noteText\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 334,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        display: 'flex',\n                        alignSelf: 'self-end',\n                        fontSize: '11px'\n                      },\n                      children: moment(new Date(i.timestamp * 1000)).format('lll')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 335,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 331,\n                    columnNumber: 25\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true),\n            children: /*#__PURE__*/_jsxDEV(InfoIcon, {\n              fontSize: \"small\",\n              style: {\n                fontSize: \"12px\",\n                cursor: \"pointer\",\n                marginLeft: \"1px\"\n              },\n              onMouseEnter: () => getNoteDetails(conversation === null || conversation === void 0 ? void 0 : conversation.wa_id)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '12px'\n          },\n          children: [`ED${conversation === null || conversation === void 0 ? void 0 : conversation.uid}`, /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"usertag_\",\n            children: shortText(conversation === null || conversation === void 0 ? void 0 : conversation.tags)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          flex: '35%',\n          flexDirection: 'column',\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            display: 'flex',\n            flex: '1',\n            justifyContent: 'flex-end',\n            padding: '10px',\n            fontSize: '12px',\n            fontWeight: 'normal'\n          },\n          children: [(conversation === null || conversation === void 0 ? void 0 : conversation.pinContact) && /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              marginRight: '14px',\n              transform: 'rotate(45deg)',\n              cursor: 'pointer'\n            },\n            children: /*#__PURE__*/_jsxDEV(PushPinIcon, {\n              style: {\n                fontSize: '15px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 387,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 15\n          }, this), diff_hours(conversation === null || conversation === void 0 ? void 0 : conversation.timestamp) < 24 ? moment(new Date((conversation === null || conversation === void 0 ? void 0 : conversation.timestamp) * 1000).toISOString()).format('hh:mm a') : moment(new Date((conversation === null || conversation === void 0 ? void 0 : conversation.timestamp) * 1000).toISOString()).format('L')]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'row',\n            alignSelf: 'flex-end'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              padding: '0px 10px',\n              marginRight: '5px'\n            },\n            children: conversation.markAsUnread && /*#__PURE__*/_jsxDEV(Badge, {\n              badgeContent: '',\n              color: \"primary\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 412,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 13\n          }, this), conversation.newMsgCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              padding: '0px 10px',\n              marginRight: '5px'\n            },\n            children: /*#__PURE__*/_jsxDEV(Badge, {\n              badgeContent: conversation.newMsgCount,\n              color: \"success\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 422,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              paddingRight: '5px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(KeyboardArrowDownIcon, {\n              fontSize: \"small\",\n              color: \"action\",\n              onClick: e => {\n                e.stopPropagation();\n                handleClick(e);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 429,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Menu, {\n              id: \"basic-menu\",\n              anchorEl: anchorEl,\n              open: open,\n              onClose: handleClose,\n              MenuListProps: {\n                'aria-labelledby': 'basic-button'\n              },\n              children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n                onClick: e => {\n                  e.stopPropagation();\n                  handlePinChat(conversation === null || conversation === void 0 ? void 0 : conversation.wa_id, conversation === null || conversation === void 0 ? void 0 : conversation.pinContact);\n                  handleClose();\n                },\n                children: conversation !== null && conversation !== void 0 && conversation.pinContact ? 'Unpin chat' : 'Pin chat'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 446,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n                onClick: e => {\n                  e.stopPropagation();\n                  handleMarkChat(conversation === null || conversation === void 0 ? void 0 : conversation.wa_id, conversation === null || conversation === void 0 ? void 0 : conversation.markAsUnread);\n                  handleClose();\n                },\n                children: conversation !== null && conversation !== void 0 && conversation.markAsUnread ? 'Mark as read' : 'Mark as unread'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n                onClick: e => {\n                  e.stopPropagation(); // setWhatsId(conversation?.wa_id)\n                  // fetchStickComments(conversation?.wa_id)\n                },\n                children: /*#__PURE__*/_jsxDEV(StickComments, {\n                  handleStickComments: handleStickComments,\n                  fetchStickComments: fetchStickComments,\n                  wa_id: conversation === null || conversation === void 0 ? void 0 : conversation.wa_id,\n                  setStickComments: setStickComments,\n                  stickComments: stickComments\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 479,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 287,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Conversation, \"vQotJTrX437pFzX+Xn+Yr81sHOM=\");\n\n_c = Conversation;\n\nvar _c;\n\n$RefreshReg$(_c, \"Conversation\");","map":{"version":3,"names":["axios","useEffect","useState","useRef","msgUrl","alertMsgUrl","pinChatUrl","markChatUrl","stickComment","fetchStickComment","NotificationsIcon","io","moment","PushPinIcon","Button","Menu","MenuItem","KeyboardArrowDownIcon","Badge","Avatar","StickComments","InfoIcon","styled","Tooltip","tooltipClasses","Typography","HtmlTooltip","className","props","popper","theme","tooltip","backgroundColor","color","fontWeight","maxWidth","fontSize","typography","pxToRem","border","overflowX","overflowY","maxHeight","Conversation","apiUrl","conversation","currentUser","currentChat","finalMessage","arrivalMessage","alertMsg","alert","setAlert","setPinned","setMarkChat","setAlertUpdate","msg","setMsg","alertText","setAlertText","alertMessage","setAlertMessage","msgCount","setMsgCount","socket","alertIcon","PF","process","env","REACT_APP_PUBLIC_FOLDER","headerKey","Accept","Authorization","anchorEl","setAnchorEl","stickComments","setStickComments","noteDetails","setNoteDetails","open","Boolean","handleClick","event","currentTarget","handleClose","console","log","updateAlert","wa_id","newMsgCount","payload","timestamp","Math","floor","Date","getTime","response","put","localStorage","getItem","headers","err","diff_hours","dt1","diff","abs","round","handlePinChat","waId","pin","pinContact","res","data","updatedAt","handleMarkChat","markChat","markAsUnread","handleStickComments","whatsId","comments","fetchStickComments","get","getNoteDetails","shortText","text","length","slice","name","paddingBottom","marginBottom","map","i","display","justifyContent","padding","borderBottom","flex","clientNotes","priority","noteText","alignSelf","format","cursor","marginLeft","uid","tags","flexDirection","marginRight","transform","toISOString","paddingRight","e","stopPropagation"],"sources":["C:/Users/AEPL/Desktop/Git Clones/Dummy_project/Backend/dummy1/src/components/conversations/Conversation.jsx"],"sourcesContent":["import axios from 'axios';\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport './conversation.css';\r\nimport {\r\n  msgUrl,\r\n  alertMsgUrl,\r\n  pinChatUrl,\r\n  markChatUrl,\r\n  stickComment,\r\n  fetchStickComment\r\n} from '../../serviceUrls/Message-Services';\r\nimport NotificationsIcon from '@material-ui/icons/Notifications';\r\nimport { io } from 'socket.io-client';\r\nimport moment from 'moment';\r\nimport PushPinIcon from '@mui/icons-material/PushPin';\r\nimport Button from '@mui/material/Button';\r\nimport Menu from '@mui/material/Menu';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport Badge from '@mui/material/Badge';\r\nimport Avatar from '@mui/material/Avatar';\r\nimport StickComments from \"../dialogs/StickComments\"\r\nimport InfoIcon from \"@mui/icons-material/Info\";\r\nimport { styled } from \"@mui/material/styles\";\r\nimport Tooltip, { tooltipClasses } from \"@mui/material/Tooltip\";\r\nimport Typography from \"@mui/material/Typography\";\r\n\r\nconst HtmlTooltip = styled(({ className, ...props }) => (\r\n  <Tooltip {...props} classes={{ popper: className }} />\r\n))(({ theme }) => ({\r\n  [`& .${tooltipClasses.tooltip}`]: {\r\n    backgroundColor: \"rgba(80, 80, 80, 0.92)\",\r\n    color: \"#ffff\",\r\n    fontWeight: \"500\",\r\n    maxWidth: 350,\r\n    fontSize: theme.typography.pxToRem(12),\r\n    border: \"1px solid rgba(80, 80, 80, 0.92)\",\r\n    overflowX: \"hidden\",\r\n    overflowY: \"scroll\",\r\n    maxHeight: \"300px\"\r\n  },\r\n}));\r\n// import useSound from 'use-sound';\r\n\r\n// import notification from '../../assets/notification.mp3';\r\n\r\nexport default function Conversation({\r\n  apiUrl,\r\n  conversation,\r\n  currentUser,\r\n  currentChat,\r\n  finalMessage,\r\n  arrivalMessage,\r\n  alertMsg,\r\n  alert,\r\n  setAlert,\r\n  setPinned,\r\n  setMarkChat,\r\n  setAlertUpdate,\r\n}) {\r\n  const [msg, setMsg] = useState([]);\r\n  const [alertText, setAlertText] = useState([]);\r\n  const [alertMessage, setAlertMessage] = useState([]);\r\n  // const [hide, setHide] = useState(false);\r\n  const [msgCount, setMsgCount] = useState();\r\n\r\n  const socket = useRef();\r\n  const alertIcon = useRef();\r\n  const PF = process.env.REACT_APP_PUBLIC_FOLDER;\r\n  const headerKey = {\r\n    Accept: 'application/json',\r\n    Authorization:\r\n      'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMTYyMWZkZi0wYjJjLTQxYzAtOWZmMS1iZDk5NWZmYTQ2ZTUiLCJ1bmlxdWVfbmFtZSI6Im9mZmljZUB0dXRvcnBvaW50LmluIiwibmFtZWlkIjoib2ZmaWNlQHR1dG9ycG9pbnQuaW4iLCJlbWFpbCI6Im9mZmljZUB0dXRvcnBvaW50LmluIiwiYXV0aF90aW1lIjoiMDgvMDQvMjAyMSAwODoxMTowMSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IkFETUlOSVNUUkFUT1IiLCJleHAiOjI1MzQwMjMwMDgwMCwiaXNzIjoiQ2xhcmVfQUkiLCJhdWQiOiJDbGFyZV9BSSJ9.lSSh1EL29ksj23Y_rTSrLhYVwhOFyddK1c6bKU-_HB4',\r\n  };\r\n\r\n  const [anchorEl, setAnchorEl] = useState(null);\r\n  const [stickComments,setStickComments] =useState();\r\n  const [noteDetails, setNoteDetails] = useState();\r\n  const open = Boolean(anchorEl);\r\n  const handleClick = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n  console.log(msg);\r\n  // useEffect(() => {\r\n  //   const friendId = conversation.id;\r\n\r\n  //   const getUser = async () => {\r\n  //     try {\r\n  //       const res = await axios(getCustomersUrl + `/${friendId}`, {headers: {...headerKey}});\r\n  //       setUser(res.data);\r\n  //     } catch (err) {\r\n  //       console.log(err);\r\n  //     }\r\n  //   };\r\n  //   getUser();\r\n  // }, [conversation]);\r\n\r\n  // useEffect(() => {\r\n  //   socket.current = io('ws://localhost:8900');\r\n  //   socket.current.on('getAlert', (msg) => {\r\n  //     // storeFiles(msg); //store incoming files data to excel\r\n  //     setAlertMsg([msg]);\r\n  //   });\r\n  // }, []);\r\n\r\n  // const [play] = useSound(notification);\r\n\r\n  // useEffect(() => {\r\n  //   const getMessages = async () => {\r\n  //     try {\r\n  //       const res = await axios.get(\r\n  //         msgUrl + `/${conversation?.wa_id}?page=0&limit=20`,\r\n  //         {\r\n  //           headers: { ...headerKey },\r\n  //         }\r\n  //       );\r\n  //       console.log(res.data);\r\n  //       // setMessages(() =>\r\n  //       //   res?.data?.messages?.items\r\n  //       //     .filter((f) => f.eventType === 'message')\r\n  //       //     .reverse()\r\n  //       // );\r\n  //       setMsg([...res?.data]);\r\n  //     } catch (err) {\r\n  //       console.log(err);\r\n  //     }\r\n  //   };\r\n  //   getMessages();\r\n  // }, [newNotification, alertMsg]);\r\n\r\n  // console.log(arrivalMessage.length);\r\n\r\n  // // useEffect(() => {\r\n  // //   play();\r\n  // // }, [arrivalMessage?.length])\r\n\r\n  // useEffect(() => {\r\n  //   const getAlert = async () => {\r\n  //     try {\r\n  //       const res = await axios.get(alertMsgUrl + `/${conversation?.wa_id}`, {\r\n  //         headers: {},\r\n  //       });\r\n  //       console.log(res.data);\r\n  //       // setMessages(() =>\r\n  //       //   res?.data?.messages?.items\r\n  //       //     .filter((f) => f.eventType === 'message')\r\n  //       //     .reverse()\r\n  //       // );\r\n  //       setMsg([...res?.data]);\r\n  //       setMsgCount(() => res?.data?.filter((i) => i.status === 'newMsg' && i.wa_id == conversation?.wa_id).length);\r\n  //       setHide(false);\r\n  //     } catch (err) {\r\n  //       console.log(err);\r\n  //     }\r\n  //   };\r\n  //   getAlert();\r\n  // }, [alertMsg, newNotification]);\r\n\r\n  // console.log(alertMessage);\r\n\r\n  // useEffect(() => {\r\n  //   setMsgCount(\r\n  //     () =>\r\n  //       alertMessage?.filter(\r\n  //         (i) => i.status === 'newMsg' && i.wa_id == conversation?.wa_id\r\n  //       ).length\r\n  //   );\r\n  // }, [alertMessage, alertMsg, newNotification]);\r\n\r\n  const updateAlert = async (wa_id) => {\r\n    if (conversation.newMsgCount > 0) {\r\n      try {\r\n        const payload = {\r\n          newMsgCount: 0,\r\n          timestamp: Math.floor(new Date().getTime() / 1000.0),\r\n        };\r\n        const response = await axios.put(\r\n          `${apiUrl || localStorage.getItem('api')}/api/conversations/${wa_id}`,\r\n          payload,\r\n          {\r\n            headers: {},\r\n          }\r\n        );\r\n        setAlertUpdate(Math.floor(new Date().getTime() / 1000.0));\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    }\r\n  };\r\n\r\n  console.log(alertMessage);\r\n\r\n  const diff_hours = (dt1) => {\r\n    var diff = new Date().getTime() / 1000.0 - dt1;\r\n    diff /= 60 * 60;\r\n    return Math.abs(Math.round(diff));\r\n  };\r\n\r\n  // const filteredArrivalMessage = alertMsg?.filter(\r\n  //   (i) => i.wAid === conversation.wAid\r\n  // );\r\n\r\n  // const newNoti = (id) => {\r\n  //   let filtered = alertText.filter((i) => i.waId === id);\r\n  //   console.log(filtered);\r\n  //   return { arr: filtered, len: filtered.length };\r\n  // };\r\n\r\n  // useEffect(() => {\r\n  //   setAlertText([...alertText, ...alertMsg]);\r\n  //   setAlert(alert + 1);\r\n  //   // return () => {\r\n  //   //   setAlertText([])\r\n  //   // }\r\n  // }, [alertMsg]);\r\n\r\n  // let filteredAlert = alertText?.filter((i) => i.waId === conversation?.wAid);\r\n\r\n  // console.log(alertMsg);\r\n  // console.log(alertText);\r\n  // console.log(alert);\r\n\r\n  const handlePinChat = async (waId, pin) => {\r\n    const payload = {\r\n      pinContact: !pin,\r\n    };\r\n    const res = await axios.put(pinChatUrl + `/${waId}`, payload, {\r\n      headers: '',\r\n    });\r\n    setPinned(res?.data?.updatedAt);\r\n  };\r\n\r\n  const handleMarkChat = async (waId, markChat) => {\r\n    const payload = {\r\n      markAsUnread: !markChat,\r\n    };\r\n    const res = await axios.put(markChatUrl + `/${waId}`, payload, {\r\n      headers: '',\r\n    });\r\n    setMarkChat(res?.data?.updatedAt);\r\n  };\r\n\r\n  const handleStickComments = async (whatsId, stickComments) => {\r\n    const payload = {\r\n      comments: stickComments,\r\n    };\r\n    const res = await axios.put(stickComment + `/${whatsId}`, payload, {\r\n      headers: '',\r\n    });\r\n    fetchStickComments(whatsId)\r\n    // setStickComments(res?.data?.comments);\r\n    handleClose()\r\n  };\r\n\r\n  const fetchStickComments = async (waId) => {\r\n  \r\n    const res = await axios.get(fetchStickComment + `/${waId}`);\r\n    if(res.data){\r\n      setStickComments(res.data)\r\n    }\r\n   \r\n  };\r\n\r\n  const getNoteDetails = async (waId) => {\r\n    try{\r\n      const response = await axios.get(`${localStorage.getItem(\"api\")}/api/messages/getNotes/${waId}`);\r\n      setNoteDetails(response.data);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n\r\n  }\r\n\r\n  const shortText = (text) => {\r\n    if(text.length > 17) {\r\n      return `${text.slice(0, 17)}..`;\r\n    }\r\n    else if(text.length <= 17) {\r\n      return text;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={\r\n        currentChat?.wa_id == conversation?.wa_id\r\n          ? 'conversation highlighted'\r\n          : 'conversation'\r\n      }\r\n      onClick={() => {\r\n        updateAlert(conversation?.wa_id);\r\n      }}\r\n    >\r\n      <div className='userTab'>\r\n        <Avatar className='conversationImg'>\r\n          {conversation?.name?.slice(0, 2)}\r\n        </Avatar>\r\n        <div style={{ paddingBottom: '5px' }}>\r\n          <div className='conversationName'>{`${\r\n            conversation?.name\r\n          }${conversation?.wa_id.slice(0, 3)}`}\r\n            <HtmlTooltip\r\n                placement=\"right\"\r\n                title={\r\n                  <>\r\n                    <Typography\r\n                      color=\"inherit\"\r\n                      style={{\r\n                        fontSize: \"13.5px\",\r\n                        fontWeight: \"600\",\r\n                        marginBottom: \"5px\",\r\n                      }}\r\n                    >\r\n                    {noteDetails && noteDetails.length > 0 ? 'Notes: ' : 'No Notes'}\r\n                    </Typography>\r\n                    {noteDetails && noteDetails.length > 0 && (\r\n                      <Typography\r\n                        color=\"inherit\"\r\n                        style={{\r\n                          fontSize: \"13.5px\",\r\n                          fontWeight: \"600\",\r\n                          marginBottom: \"5px\",\r\n                          maxHeight:\"500px\",\r\n                          overflowY:\"scroll\"\r\n                        }}\r\n                      >\r\n                        {noteDetails.map((i) => \r\n                        <div\r\n                          style={{ display: 'flex', justifyContent: 'space-between', fontSize: \"12px\", fontWeight: \"normal\", padding: '8px 5px', borderBottom: '1px solid #ffff' }}\r\n                        >\r\n                          <div style={{display: 'flex', flex: '60%', fontSize: '13px', fontWeight: '600', color: i?.clientNotes?.priority === 'high' ? 'red' : i?.clientNotes?.priority === 'medium' ? 'royalblue' : '#565555'}}>{i?.clientNotes?.noteText}</div>\r\n                          <div style={{display: 'flex', alignSelf: 'self-end', fontSize: '11px'}}>\r\n                            {moment(new Date(i.timestamp * 1000)).format('lll')}\r\n                          </div>\r\n                        </div>)}\r\n                      </Typography>\r\n                    )}\r\n                   \r\n                  </>\r\n                }\r\n              >\r\n                <InfoIcon\r\n                  fontSize=\"small\"\r\n                  style={{\r\n                    fontSize: \"12px\",\r\n                    cursor: \"pointer\",\r\n                    marginLeft: \"1px\",\r\n                  }}\r\n                  onMouseEnter={() => getNoteDetails(conversation?.wa_id)}\r\n                />\r\n            </HtmlTooltip>\r\n          </div>\r\n          <div style={{ fontSize: '12px' }}>\r\n            {`ED${conversation?.uid}`}\r\n            <span className='usertag_'>{shortText(conversation?.tags)}</span>\r\n          </div>\r\n        </div>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            flex: '35%',\r\n            flexDirection: 'column',\r\n            justifyContent: 'flex-end',\r\n          }}\r\n        >\r\n          <span\r\n            style={{\r\n              display: 'flex',\r\n              flex: '1',\r\n              justifyContent: 'flex-end',\r\n              padding: '10px',\r\n              fontSize: '12px',\r\n              fontWeight: 'normal',\r\n            }}\r\n          >\r\n            {conversation?.pinContact && (\r\n              <span\r\n                style={{\r\n                  marginRight: '14px',\r\n                  transform: 'rotate(45deg)',\r\n                  cursor: 'pointer',\r\n                }}\r\n              >\r\n                <PushPinIcon style={{ fontSize: '15px' }} />\r\n              </span>\r\n            )}\r\n            {diff_hours(conversation?.timestamp) < 24\r\n              ? moment(\r\n                  new Date(conversation?.timestamp * 1000).toISOString()\r\n                ).format('hh:mm a')\r\n              : moment(\r\n                  new Date(conversation?.timestamp * 1000).toISOString()\r\n                ).format('L')}\r\n          </span>\r\n          <div\r\n            style={{\r\n              display: 'flex',\r\n              flexDirection: 'row',\r\n              alignSelf: 'flex-end',\r\n            }}\r\n          >\r\n            <span\r\n              style={{\r\n                padding: '0px 10px',\r\n                marginRight: '5px',\r\n              }}\r\n            >\r\n              {conversation.markAsUnread && (\r\n                <Badge badgeContent={''} color='primary'></Badge>\r\n              )}\r\n            </span>\r\n            {conversation.newMsgCount > 0 && (\r\n              <span\r\n                style={{\r\n                  padding: '0px 10px',\r\n                  marginRight: '5px',\r\n                }}\r\n              >\r\n                <Badge\r\n                  badgeContent={conversation.newMsgCount}\r\n                  color='success'\r\n                ></Badge>\r\n              </span>\r\n            )}\r\n            <span style={{ paddingRight: '5px' }}>\r\n              <KeyboardArrowDownIcon\r\n                fontSize='small'\r\n                color='action'\r\n                onClick={(e) => {\r\n                  e.stopPropagation(); \r\n                  handleClick(e);\r\n                }}\r\n              />\r\n              <Menu\r\n                id='basic-menu'\r\n                anchorEl={anchorEl}\r\n                open={open}\r\n                onClose={handleClose}\r\n                MenuListProps={{\r\n                  'aria-labelledby': 'basic-button',\r\n                }}\r\n              >\r\n                <MenuItem\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handlePinChat(\r\n                      conversation?.wa_id,\r\n                      conversation?.pinContact\r\n                    );\r\n                    handleClose();\r\n                  }}\r\n                >\r\n                  {conversation?.pinContact ? 'Unpin chat' : 'Pin chat'}\r\n                </MenuItem>\r\n                <MenuItem\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handleMarkChat(\r\n                      conversation?.wa_id,\r\n                      conversation?.markAsUnread\r\n                    );\r\n                    handleClose();\r\n                  }}\r\n                >\r\n                  {conversation?.markAsUnread\r\n                    ? 'Mark as read'\r\n                    : 'Mark as unread'}\r\n                </MenuItem>\r\n                <MenuItem\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    // setWhatsId(conversation?.wa_id)\r\n                    // fetchStickComments(conversation?.wa_id)\r\n                  }}\r\n                >\r\n                  <StickComments handleStickComments={handleStickComments} fetchStickComments={fetchStickComments} wa_id={conversation?.wa_id} setStickComments={setStickComments} stickComments={stickComments}/>\r\n                  {/* {conversation?.pinContact ? 'Unpin chat' : 'Pin chat'} */}\r\n                </MenuItem>\r\n              </Menu>\r\n            </span>\r\n          </div>\r\n          {/* {filteredAlert.length > 0 ? (\r\n            <div\r\n              style={{\r\n                display: 'flex',\r\n                justifyContent: 'flex-end',\r\n                padding: '0px 10px 0px 0px',\r\n              }}\r\n              ref={alertIcon}\r\n            >\r\n              <NotificationsIcon style={{ color: '#03D755' }} />\r\n            </div>\r\n          ) : null} */}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}